!function(e){var t={};function s(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,s),o.l=!0,o.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(i,o,function(t){return e[t]}.bind(null,o));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=1)}([function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));class i{constructor(e){this.loaded=!1,this.app=e,this.resources=[]}load(e){this.app.loader.add(this.resources.filter(e=>{if(!this.app.loader.resources[e])return e})),this.app.loader.load(t=>{this.show(t.resources),e&&e()})}show(e){}hide(){}}},function(e,t,s){const{DancingStormtrooper:i}=s(2),{ShatteringEngel:o}=s(3),{Overlay:a}=s(4),{DemoThumb:n}=s(5),{PinkCube:r}=s(8);PIXI.settings.GC_MODE=PIXI.GC_MODES.MANUAL;let h=new PIXI.Application({backgroundColor:16711680,antialias:!0,view:document.getElementById("demo-canvas"),resizeTo:window}),l=new a("ui-overlay"),c=new a("load-overlay"),m=e=>{document.body.classList.remove("disable-scrolling"),l.hide(()=>{document.getElementById("demo-canvas").classList.remove("show"),e.hide()})},d=e=>{document.body.classList.add("disable-scrolling"),document.onkeypress=t=>{"Escape"===t.key&&m(e)},document.getElementById("ui-close").onclick=()=>{m(e)},c.show(()=>{e.load(()=>{document.getElementById("demo-canvas").classList.add("show"),l.show(()=>{c.hide()})})})};new n("dancing-stormtrooper",new i(h),"<a href='https://sketchfab.com/3d-models/dancing-stormtrooper-12bd08d66fe04a84be446e583d6663ac'>Model created by StrykerDoesAnimation.</a> License: <a href='https://creativecommons.org/licenses/by/4.0/'>CC Attribution</a>.",d),new n("pink-cube",new r(h),"",d),new n("shattering-engel",new o(h),"<a href='https://sketchfab.com/3d-models/engel-c958d74ae18c4734b37dbc3ff0841f8a'>Model created by noe-3d.at.</a> License: <a href='https://creativecommons.org/licenses/by/4.0/'>CC Attribution</a>.",d)},function(e,t,s){"use strict";s.r(t),s.d(t,"DancingStormtrooper",(function(){return o}));var i=s(0);class o extends i.a{constructor(e){super(e),this.resources=["models/dancing_stormtrooper/scene.gltf","environments/photo_studio/diffuse.cubemap","environments/photo_studio/specular.cubemap"]}show(e){this.app.renderer.backgroundColor=39219,this.dirLight=Object.assign(new PIXI3D.Light,{type:"directional",intensity:1.5,x:0,y:0,z:5}),this.dirLight.rotationQuaternion.setEulerAngles(10,180,0);let t=new PIXI3D.ImageBasedLighting(e["environments/photo_studio/diffuse.cubemap"].cubemap,e["environments/photo_studio/specular.cubemap"].cubemap);this.lightingEnvironment=new PIXI3D.LightingEnvironment(this.app.renderer,t),this.lightingEnvironment.lights.push(this.dirLight),this.camera=new PIXI3D.Camera(this.app.renderer),this.camera.rotationQuaternion.setEulerAngles(-10,180,0),this.container=this.app.stage.addChild(new PIXI3D.Container3D),this.model=this.container.addChild(PIXI3D.Model.from(e["models/dancing_stormtrooper/scene.gltf"].gltf)),this.model.scale.set(2.3),this.model.y=-5.2,this.model.rotationQuaternion.setEulerAngles(0,0,0),this.model.meshes.forEach(e=>{e.material.camera=this.camera,e.material.lightingEnvironment=this.lightingEnvironment,e.material.exposure=1}),this.model.animations[0].loop=!0,this.model.animations[0].play(),this.shadowCastingLight=new PIXI3D.ShadowCastingLight(this.app.renderer,this.dirLight,1024,15,1,PIXI3D.ShadowQuality.medium),PIXI3D.StandardPipeline.from(this.app.renderer).enableShadows(this.model,this.shadowCastingLight)}hide(){this.shadowCastingLight.destroy(),this.model.meshes.forEach(e=>{e.destroy()}),PIXI3D.StandardPipeline.from(this.app.renderer).shadowPass.removeShadowCastingLight(this.shadowCastingLight),this.app.stage.removeChildren()}}},function(e,t,s){"use strict";s.r(t),s.d(t,"ShatteringEngel",(function(){return o}));var i=s(0);class o extends i.a{constructor(e){super(e),this.resources=["models/engel/engel1.gltf","models/engel/engel2.gltf"]}show(e){document.getElementById("ui-content").innerHTML="<i class='far fa-hand-pointer fa-6x hand-pointer'></i>",this.app.renderer.backgroundColor=8895433,this.ambientLight=Object.assign(new PIXI3D.Light,{type:"ambient",intensity:1,color:new PIXI3D.Color(.8,.8,1)}),this.spotLight=Object.assign(new PIXI3D.Light,{type:"spot",intensity:100,x:0,y:2,z:5,color:new PIXI3D.Color(1,1,1),range:30}),this.spotLight.rotationQuaternion.setEulerAngles(0,180,0),this.lightingEnvironment=new PIXI3D.LightingEnvironment(this.app.renderer),this.lightingEnvironment.lights.push(this.spotLight),this.lightingEnvironment.lights.push(this.ambientLight),this.camera=new PIXI3D.Camera(this.app.renderer),this.camera.rotationQuaternion.setEulerAngles(-10,180,0),this.container=this.app.stage.addChild(new PIXI3D.Container3D),this.container.y=-3.3,this.container.scale.set(.85),this.model1=this.container.addChild(PIXI3D.Model.from(e["models/engel/engel1.gltf"].gltf)),this.model1.visible=!0,this.model1.interactive=!0,this.model1.buttonMode=!0,this.model1.hitArea=new PIXI3D.PickingHitArea(this.app.renderer,this.model1,this.camera),this.model1.on("pointerdown",()=>{this.model2.animations.forEach(e=>{e.play(),e.position=.63}),this.model1.visible=!1,this.model2.visible=!0,document.getElementById("ui-content").innerHTML=""}),this.model1.meshes.forEach(e=>{e.material.camera=this.camera,e.material.lightingEnvironment=this.lightingEnvironment,e.material.exposure=1}),this.model2=this.container.addChild(PIXI3D.Model.from(e["models/engel/engel2.gltf"].gltf)),this.model2.visible=!1,this.model2.meshes.forEach(e=>{e.material.camera=this.camera,e.material.lightingEnvironment=this.lightingEnvironment,e.material.exposure=1}),this.model2.animations.forEach(e=>{e.speed=1.5,e.on("complete",()=>{this.model1.visible=!0,this.model2.visible=!1})})}hide(){this.model1.meshes.forEach(e=>{e.destroy()}),this.model2.meshes.forEach(e=>{e.destroy()}),this.app.stage.removeChildren(),document.getElementById("ui-content").innerHTML=""}}},function(e,t,s){"use strict";s.r(t),s.d(t,"Overlay",(function(){return i}));class i{constructor(e){this.element=document.getElementById(e),this.element.classList.add("overlay")}show(e){this.element.classList.add("overlay-show"),e&&setTimeout(()=>{e()},.5)}hide(e){this.element.classList.remove("overlay-show"),e&&setTimeout(()=>{e()},.5)}}},function(e,t,s){"use strict";s.r(t),s.d(t,"DemoThumb",(function(){return i}));class i{constructor(e,t,s,i){this.demo=t,this.element=document.getElementById(e),this.element.addEventListener("click",()=>{i(t),document.getElementById("ui-license").innerHTML=s})}select(){this.element.click()}}},function(e,t){e.exports="attribute vec3 a_Position;\nattribute vec3 a_UV1;\nattribute vec3 a_Normal;\n\nvarying vec4 v_Position;\nvarying vec3 v_UV1;\nvarying vec3 v_Normal;\n\nuniform mat4 u_ViewProjection;\nuniform mat4 u_Model;\n\nvoid main() {\n  v_Position = u_Model * vec4(a_Position, 1.0);\n  v_Normal = a_Normal;\n  v_UV1 = a_UV1;\n  gl_Position = u_ViewProjection * u_Model * vec4(a_Position, 1.0);\n}"},function(e,t){e.exports="varying vec3 v_Normal;\nvarying vec3 v_UV1;\nvarying vec4 v_Position;\n\nuniform vec3 u_Color;\nuniform vec3 u_Color2;\nuniform float u_Alpha;\n\nvoid main() {\n  vec3 pos = v_Position.xyz / v_Position.w;\n  if (pos.y < -4.0) {\n    // discard;\n  }\n  vec3 normal = normalize(v_Normal * 0.5 + 0.5);\n  float up = normal.y; //float( > 0.0 || v_Normal.x < 0.0 || v_Normal.z > 0.0 || v_Normal.z < 0.0);\n  float alpha = 1.0;// + (v_Position.y * 0.5);\n  float shade = normal.y + normal.x * 0.1;\n  // vec3 color = u_Color;// - (normal.z * 0.5);\n  // if (pos.y <= -2.0) {\n  //   color = mix(color, vec3(0.0, 0.0, 0.0), (-2.0 - pos.y) * 0.5);\n  //   float a = (-2.0 - pos.y) * 0.5;\n  //   color = vec3(a);\n  // }\n\n  float a = -1.0;\n  float b = -7.0;\n\n  float fade = clamp((a - pos.y) * (a/b), 0.0, 1.0);\n  vec3 color = mix(u_Color * shade, u_Color2, pow(fade, 0.9));\n\n  // vec3 color = u_Color * (v_Normal * 0.5 + 0.5);\n  // vec4 color = vec4((u_Color * (v_Normal * 0.5 + 0.5)) * alpha, alpha);\n  // gl_FragColor = vec4(vec3(v_Position.y + 1.0), 1.0);\n  // gl_FragColor = vec4(u_Color * (v_Normal * 0.5 + 0.5), 1.0);\n  gl_FragColor = vec4(vec3(color * 1.0 * u_Alpha), u_Alpha);\n}"},function(e,t,s){"use strict";s.r(t),s.d(t,"PinkCube",(function(){return k}));var i=s(0);const o="player_move",a="player_move_blocked",n="player_move_fall",r="player_move_jump",h="player_goal",l="block_move",c="block_move_fall",m="gate_open",d="gate_close",p="button_press",u="button_release",_="scene_crash";class g extends PIXI3D.Container3D{constructor(e=0,t=0,s=0,i){super(),this.position.set(e,t,s),this._mesh=this.addChild(PIXI3D.Mesh3D.createCube()),this._mesh.scale.set(.5,.5,.5),this._mesh.material.lightingEnvironment=i,this._mesh.material.metallic=0,this._mesh.material.roughness=.2,this._mesh.material.unlit=!1,this._mesh.material.baseColor=new PIXI3D.Color(.1,.1,.1),this._mesh.position.set(0,0,0)}move(e){gsap.to(this,{x:this.x+e.x,z:this.z+e.z,duration:.2,ease:"power1.out"})}moveFall(e,t){gsap.to(this,{x:this.x+e.x,z:this.z+e.z,duration:.2}),gsap.to(this,{y:t,duration:.3,delay:0,ease:"back.in"})}}class y extends PIXI3D.Material{constructor(){super(),this.color=new PIXI3D.Color,this.color2=new PIXI3D.Color(1,180/255,248/255),this.alpha=1}createShader(){return new PIXI3D.MeshShader(PIXI.Program.from(s(6),s(7)))}updateUniforms(e,t){t.uniforms.u_Model=e.worldTransform.array,t.uniforms.u_ViewProjection=PIXI3D.Camera.main.viewProjection,t.uniforms.u_Color=this.color.rgba,t.uniforms.u_Color2=this.color2.rgba,t.uniforms.u_Alpha=this.alpha}}class v extends PIXI3D.Container3D{constructor(e=0,t=0,s=0){super(),this.position.set(e,t,s);const i=(e%2==0?s%2==1:s%2==0)?1:.95;this._mesh=this.addChild(PIXI3D.Mesh3D.createCube(new y)),this._mesh.scale.set(.5,.5,.5),this._mesh.material.color=new PIXI3D.Color(.2*i,1*i,.4*i),this._mesh.position.set(0,-.9,0)}press(){gsap.to(this._mesh,{y:-1,duration:.2})}release(){gsap.to(this._mesh,{y:-.93,duration:.2})}}class f{constructor(e){PIXI3D.Camera.main.orthographic=!0,PIXI3D.Camera.main.orthographicSize=7,this.drag={x:.5,y:.01,z:.5},this._control=new PIXI3D.CameraOrbitControl(e),this._control.allowControl=!1,this._control.angles.set(25,-20),this._control.distance=100,this._track={x:0,y:0,z:0};const t=(e,t,s)=>e+(t-e)*s;PIXI.Ticker.shared.add(()=>{this._control.target={x:t(this._control.target.x,this._track.x,this.drag.x),y:t(this._control.target.y,this._track.y,this.drag.y),z:t(this._control.target.z,this._track.z,this.drag.z)}})}get zoom(){return PIXI3D.Camera.main.orthographicSize}set zoom(e){PIXI3D.Camera.main.orthographicSize=e}get angles(){return this._control.angles}reset(){PIXI3D.Camera.main.orthographicSize=7,this._control.angles.set(25,-20),this.drag={x:.5,y:.01,z:.5}}track(e){this._track=e}lookAt(e){this._track=e,this._control.target=e}}class I extends PIXI3D.Container3D{constructor(e=0,t=0,s=0){super(),this.position.set(e,t,s);let i=(e%2==0?s%2==1:s%2==0)?1:.95;this._mesh=this.addChild(PIXI3D.Mesh3D.createCube(new y)),this._mesh.scale.set(.5,20,.5),this._mesh.material.color=new PIXI3D.Color(.1*i,.9*i,.3*i),this._mesh.position.set(0,-this._mesh.scale.y-.5,0)}}class x extends PIXI3D.Container3D{constructor(e=0,t=0,s=0,i=0){super(),this.position.set(e,t,s),this._mesh=this.addChild(PIXI3D.Mesh3D.createCube(new y)),this._mesh.scale.set(.5,1,.1),this._mesh.material.color=PIXI3D.Color.fromBytes(200,255,200),90===i&&this._mesh.rotationQuaternion.setEulerAngles(0,90,0)}open(){gsap.to(this._mesh,{y:-1.49,duration:1,ease:"power2.out",delay:.2})}close(){gsap.to(this._mesh,{y:0,duration:1,ease:"power2.out",delay:.2})}}class b extends PIXI3D.Container3D{constructor(e=0,t=0,s=0,i,o){super(),this.position.set(e,t,s),this._model=this.addChild(PIXI3D.Model.from(i["assets/pink-cube/goal.gltf"].gltf)),this._model.scale.set(.63),this._model.position.set(0,-.5,0),this._model.meshes.forEach(e=>{e.material.lightingEnvironment=o,e.material.baseColor=new PIXI3D.Color(0,1,0),e.material.metallic=0,e.material.roughness=.5})}}class w extends PIXI3D.Container3D{constructor(e,t,s){super(),this._camera=e,this._isMoving=!1,this._mesh=this.addChild(PIXI3D.Mesh3D.createCube()),this._mesh.material.lightingEnvironment=s,this._mesh.material.metallic=0,this._mesh.material.roughness=.5,this._mesh.material.baseColor=new PIXI3D.Color(.8,.2,.6),this._mesh.scale.set(.5),this._model=this.addChild(PIXI3D.Model.from(t["assets/pink-cube/crash.glb"].gltf)),this._model.scale.set(0),this._model.rotationQuaternion.setEulerAngles(0,180,0),this._model.meshes.forEach(e=>{e.material.lightingEnvironment=s,e.material.metallic=0,e.material.roughness=.5,e.material.baseColor=new PIXI3D.Color(.8,.2,.6)})}get isMoving(){return this._isMoving}get worldPosition(){return{x:this._mesh.worldTransform.position[0],y:this._mesh.worldTransform.position[1],z:this._mesh.worldTransform.position[2]}}reset(){this._model.scale.set(0),this._mesh.visible=!0,this._mesh.rotationQuaternion.set(0,0,0,1),this._mesh.position.set(0,0,0)}start(){this._mesh.y=2,gsap.to(this._mesh,{delay:0,duration:.5,y:0,ease:"bounce.out"})}crash(){const e={angle:0};gsap.to(e,{delay:0,duration:1.7,angle:270,ease:"power2.out",onUpdate:()=>{this._mesh.rotationQuaternion.setEulerAngles(0,0,e.angle)}}),gsap.to(this,{duration:.9,y:this.y+2,ease:"power1.out"}),gsap.to(this,{duration:.4,y:0,ease:"power1.in",delay:1,onComplete:()=>{gsap.to(this._model.animations[0],{duration:.4,speed:.2,ease:"slow(0.7, 0.7)"}),this._model.animations[0].speed=1,this._model.animations[0].play(),this._model.animations[0].position=1.65,this._mesh.visible=!1,this._model.scale.set(.5)}}),gsap.to(this,{delay:.1,duration:1.7,x:this.x-2.6,ease:"power1.out"})}move(e){this._roll(e,90*PIXI.DEG_TO_RAD,.3,!1,!0,!0)}moveBlocked(e){this._roll(e,10*PIXI.DEG_TO_RAD,.12,!0,!1,!1)}moveJump(e,t,s=.3){this._roll(e,90*PIXI.DEG_TO_RAD,s,!1,!0,!0),gsap.to(this,{y:t,duration:s,ease:"back.out"})}moveFall(e,t){this._roll(e,90*PIXI.DEG_TO_RAD,.3,!1,!0,!0),gsap.to(this,{y:t,duration:.3,ease:"back.in"})}goal(e,t,s){this._roll(e,90*PIXI.DEG_TO_RAD,.3,!1,!0,!0),gsap.to(this,{y:t,duration:.3,ease:"back.in",onComplete:()=>{s&&s()}})}_roll(e,t,s,i,o,a){if(this._isMoving)return;this._isMoving=!0;const n={value:0},r=PIXI3D.Mat4.copy(this._mesh.localTransform.array),h=i?1:0;gsap.to(n,{duration:s,value:t,yoyo:i,repeat:h,onUpdate:()=>{let t=PIXI3D.Mat4.create();PIXI3D.Mat4.translate(t,[-e.x,-1,+e.z],t),0!==e.x?PIXI3D.Mat4.rotateZ(t,n.value*e.x,t):PIXI3D.Mat4.rotateX(t,n.value*e.z,t),PIXI3D.Mat4.translate(t,[e.x,1,-e.z],t),PIXI3D.Mat4.multiply(r,t,t),this._mesh.transform.setFromMatrix(new PIXI3D.TransformMatrix(t)),o&&this._camera.track(this.worldPosition)},onComplete:()=>{a&&(this.x-=e.x,this.z+=e.z),this._mesh.scale.set(.5),this._mesh.rotationQuaternion.set(0,0,0,1),this._mesh.position.set(0),this._mesh.transform.updateLocalTransform(),this._isMoving=!1}})}}class z extends PIXI3D.Container3D{constructor(e,t,s,i){super(),this._resources=e,this._sounds=s,this._lightingEnvironment=i,this._camera=new f(t),this._stage=this.addChild(new PIXI3D.Container3D),this._player=this.addChild(new w(this._camera,this._resources,this._lightingEnvironment)),this._allowControl=!0}loadSection(e,t){this._section=e.createSection(t),this._player.position.set(this._section.player.x,this._section.player.y,this._section.player.z),this._player.reset(),this._player.start(),this._camera.lookAt({x:this._section.player.x,y:0,z:this._section.player.z}),this._camera.reset(),this._allowControl=!0,this._stage.removeChildren(),this._buttons=[],this._gates=[],this._blocks=[],this._goals=[],this._section.buttons.forEach(e=>{this._buttons.push(this._stage.addChild(new v(e.x,e.y,e.z)))}),this._section.gates.forEach(e=>{this._gates.push(this._stage.addChild(new x(e.x,e.y,e.z,e.angle)))}),this._section.floor.forEach(e=>{this._stage.addChild(new I(e.x,e.y,e.z))}),this._section.goals.forEach(e=>{this._goals.push(this._stage.addChild(new b(e.x,e.y,e.z,this._resources,this._lightingEnvironment)))}),this._section.blocks.forEach(e=>{this._blocks.push(this._stage.addChild(new g(e.x,e.y,e.z,this._lightingEnvironment)))})}_pressButton(e,t){let s=this._buttons.find(s=>s.x===e&&s.z===t);s||console.error("No button at "+e+","+t),s.press()}_releaseButton(e,t){let s=this._buttons.find(s=>s.x===e&&s.z===t);s||console.error("No button at "+e+","+t),s.release()}_openGate(e,t){let s=this._gates.find(s=>s.x===e&&s.z===t);s||console.error("No gate at "+e+","+t),s.open()}_closeGate(e,t){let s=this._gates.find(s=>s.x===e&&s.z===t);s||console.error("No gate at "+e+","+t),s.close()}_moveBlock(e,t,s){let i=this._blocks.find(s=>s.x===e&&s.z===t);i||console.error("No block at "+e+","+t),i.move(s)}_moveFallBlock(e,t,s,i){let o=this._blocks.find(s=>s.x===e&&s.z===t);o||console.error("No block at "+e+","+t),o.moveFall(s,i)}_movePlayer(e){if(this._player.isMoving||!this._allowControl)return;this._sounds.volume(.3,this._sounds.play("tap"));let t={x:0,z:0};Math.abs(e[0])>=Math.abs(e[2])?t.x=e[0]>0?1:-1:t.z=e[2]>0?1:-1;let s=this._section.movePlayer(t);this._playAnimations(s)}_crash(){this._allowControl=!1,this.onScene();const e=()=>{this._camera.track(this._player.worldPosition)};PIXI.Ticker.shared.add(e),setTimeout(()=>{gsap.to(this._camera,{duration:7.5,zoom:4,ease:"power1.inOut"})},0),setTimeout(()=>{this._player.moveJump({x:1,z:0},this._player.y+1,.7)},600),setTimeout(()=>{gsap.to(this._camera.angles,{duration:5.5,y:45,ease:"power1.inOut"})},1600),setTimeout(()=>{this._player.moveJump({x:1,z:0},this._player.y+1,1.1)},2500),setTimeout(()=>{gsap.to(this._camera.drag,{duration:1,y:.2}),this._player.crash()},5500),setTimeout(()=>{gsap.to(this._camera.drag,{duration:1,y:.2}),this._player.crash()},5500),setTimeout(()=>{this._sounds.play("sad")},6900),setTimeout(()=>{PIXI.Ticker.shared.remove(e),this.onReset()},15e3)}_playAnimations(e){for(let t of e)switch(t.animation){case o:this._player.move({x:-t.direction.x,z:t.direction.z});break;case a:this._player.moveBlocked({x:-t.direction.x,z:t.direction.z});break;case r:this._player.moveJump({x:-t.direction.x,z:t.direction.z},t.y);break;case n:this._player.moveFall({x:-t.direction.x,z:t.direction.z},t.y);break;case h:this._player.goal({x:-t.direction.x,z:t.direction.z},t.y,()=>{this.onGoal&&(this.onGoal(),this._sounds.volume(.3,this._sounds.play("win")))});break;case p:this._pressButton(t.position.x,t.position.z);break;case u:this._releaseButton(t.position.x,t.position.z);break;case m:this._openGate(t.position.x,t.position.z);break;case d:this._closeGate(t.position.x,t.position.z);break;case l:this._moveBlock(t.position.x,t.position.z,t.direction);break;case c:this._moveFallBlock(t.position.x,t.position.z,t.direction,t.y);break;case _:this._crash()}}movePlayerLeft(){this._movePlayer(PIXI3D.Camera.main.worldTransform.left)}movePlayerFoward(){this._movePlayer(PIXI3D.Camera.main.worldTransform.forward)}movePlayerBackward(){this._movePlayer(PIXI3D.Camera.main.worldTransform.backward)}movePlayerRight(){this._movePlayer(PIXI3D.Camera.main.worldTransform.right)}}class P{constructor(){this._ui=document.createElement("div"),this._ui.className="ui",document.body.appendChild(this._ui);let e=document.createElement("div");e.onclick=()=>{this.onUp()},e.className="button",this._ui.appendChild(e);let t=document.createElement("hr");this._ui.appendChild(t);let s=document.createElement("div");s.onclick=()=>{this.onLeft()},s.className="button",this._ui.appendChild(s);let i=document.createElement("div");i.onclick=()=>{this.onDown()},i.className="button",this._ui.appendChild(i);let o=document.createElement("div");o.onclick=()=>{this.onRight()},o.className="button",this._ui.appendChild(o),this._reset=document.createElement("div"),this._reset.onclick=()=>{this.onReset()},this._reset.className="reload",document.body.appendChild(this._reset)}remove(){document.body.removeChild(this._ui),document.body.removeChild(this._reset)}hide(){this._ui.className="ui",this._reset.className="reload"}show(){this._ui.className="ui show-ui",this._reset.className="reload show"}}class C{constructor(e,t){this._map=e,this._floor=t.floor.map(e=>({...e})),this._buttons=t.buttons.map(e=>({...e})),this._gates=t.gates.map(e=>({...e})),this._blocks=t.blocks.map(e=>({...e})),this._goals=t.goals.map(e=>({...e})),this._scenes=t.scenes.map(e=>({...e})),this._starts=t.starts.map(e=>({...e})),this._player=this._starts[0]}get player(){return{x:this._player.x,y:this._player.y,z:this._player.z}}get floor(){return this._floor.map(e=>({x:e.x,y:e.y,z:e.z}))}get buttons(){return this._buttons.map(e=>({x:e.x,y:e.y,z:e.z}))}get gates(){return this._gates.map(e=>({x:e.x,y:e.y,z:e.z,angle:e.angle}))}get blocks(){return this._blocks.map(e=>({x:e.x,y:e.y,z:e.z}))}get goals(){return this._goals.map(e=>({x:e.x,y:e.y,z:e.z}))}movePlayer(e){const t=[...this._moveBlock(this._player.x+e.x,this._player.y,this._player.z+e.z,e)];let s=this._getHeight(this._player.x+e.x,this._player.z+e.z);return s===this._player.y&&(this._player.x+=e.x,this._player.z+=e.z,t.push({animation:o,direction:e}),t.push(...this._releaseButton(this._player.x-e.x,this._player.z-e.z)),t.push(...this._pressButton(this._player.x,this._player.z))),s===this._player.y+1&&(this._player.x+=e.x,this._player.y=s,this._player.z+=e.z,t.push({animation:r,direction:e,y:s}),t.push(...this._scene(this._player.x,this._player.z))),s<this._player.y&&(this._player.x+=e.x,this._player.y=s,this._player.z+=e.z,this._goals.some(e=>e.x===this._player.x&&e.z===this._player.z)&&t.push({animation:h,direction:e,y:s}),t.push({animation:n,direction:e,y:s})),(s>this._player.y+1||void 0===s)&&t.push({animation:a,direction:e}),t}_moveBlock(e,t,s,i){const o=this._blocks.find(i=>i.x===e&&(void 0===t||i.y===t)&&i.z===s);if(!o)return[];const a=[];let n=this._getHeight(o.x+i.x,o.z+i.z);return n===o.y&&(o.x+=i.x,o.z+=i.z,a.push({animation:l,position:{x:e,z:s},direction:{x:i.x,z:i.z}})),n<t&&(o.x+=i.x,o.y=n,o.z+=i.z,a.push({animation:c,position:{x:e,z:s},y:n,direction:{x:i.x,z:i.z}})),a.push(...this._pressButton(o.x,o.z)),a.push(...this._releaseButton(o.x-i.x,o.z-i.z)),a}_openGate(e,t){const s=[];let i=this._gates.find(s=>s.x===e&&s.z===t);return i||console.error("No gate at "+e+","+t),i.open||(i.open=!0,s.push({animation:m,position:{x:e,z:t}})),s}_closeGate(e,t){const s=[];let i=this._gates.find(s=>s.x===e&&s.z===t);return i||console.error("No gate at "+e+","+t),i.open&&(i.open=!1,s.push({animation:d,position:{x:e,z:t}})),s}_pressButton(e,t){let s=[];for(let i of this._buttons.filter(s=>s.x===e&&s.z===t))i.pressed||(i.pressed=!0,s.push({animation:p,position:{x:e,z:t}}),i.link&&this._gates.filter(e=>e.link===i.link).forEach(e=>{s.push(...this._openGate(e.x,e.z))}));return s}_releaseButton(e,t){let s=[];for(let i of this._buttons.filter(s=>s.x===e&&s.z===t))i.pressed&&(i.pressed=!1,s.push({animation:u,position:{x:e,z:t}}),i.link&&this._gates.filter(e=>e.link===i.link&&e.auto).forEach(e=>{s.push(...this._closeGate(e.x,e.z))}));return s}_scene(e,t){return this._scenes.filter(s=>s.x===e&&s.z===t).map(e=>({animation:_,scene:e.scene}))}_getHeight(e,t){e=Math.ceil(e),t=Math.ceil(t);for(let s of this._gates)if(s.x===e&&s.z===t)return s.open?s.y:100;for(let s of this._goals)if(s.x===e&&s.z===t)return-1;const s=this._blocks.find(s=>s.x===e&&s.z===t);return s?s.y+1:this._map.getHeight(e,t)}}class D{constructor(e,t){this._texture=t,this._pixels=e.plugins.extract.pixels(PIXI.Sprite.from(t)),this._floor=[],this._player={x:0,y:0,z:0},this._buttons=[],this._gates=[],this._blocks=[],this._goals=[],this._starts=[],this._scenes=[],this._height=[];for(let e=0;e<t.width;e++){let e=[];for(let s=0;s<t.height;s++)e.push(void 0);this._height.push(e)}for(let e=0;e<this._pixels.length;e+=4){let s=this._pixels[e+0],i=this._pixels[e+1],o=this._pixels[e+2];if(0===this._pixels[e+3])continue;let a=e/4%t.width,n=(e/4-a)/t.width,r=D.getTileData(s,i,o);r&&("floor"===r.type&&this._floor.push({x:a,y:r.y,z:n}),"scene_crash"===r.type&&(this._floor.push({x:a,y:r.y,z:n}),this._scenes.push({x:a,y:r.y,z:n,scene:"crash"})),"start"===r.type&&(this._starts.push({x:a,y:r.y,z:n,level:o}),this._floor.push({x:a,y:r.y,z:n})),"button"===r.type&&(this._floor.push({x:a,y:r.y,z:n}),this._buttons.push({x:a,y:r.y,z:n,link:o,pressed:!1})),"gate"!==r.type&&"gate_90"!==r.type||(this._floor.push({x:a,y:r.y,z:n}),this._gates.push({x:a,y:r.y,z:n,open:!1,link:o,angle:r.angle})),"auto_gate"!==r.type&&"auto_gate_90"!==r.type||(this._floor.push({x:a,y:r.y,z:n}),this._gates.push({x:a,y:r.y,z:n,open:!1,auto:!0,link:o,angle:r.angle})),"block"===r.type&&(this._floor.push({x:a,y:r.y,z:n}),this._blocks.push({x:a,y:r.y,z:n})),"goal"===r.type&&this._goals.push({x:a,y:r.y,z:n}),this._height[a][n]=r.y)}this._starts.sort((e,t)=>e.level-t.level)}get levels(){return this._starts.length}createSection(e){let t=this._starts[e];if(!t)return void console.error(`Can load level ${e}, doesn't exist`);let s=[],i=(e,t)=>{s.some(s=>s.x===e&&s.z===t)||void 0!==this._height[e][t]&&(s.push({x:e,z:t}),i(e-1,t-0),i(e+1,t-0),i(e-0,t-1),i(e-0,t+1))};return i(t.x,t.z),new C(this,{floor:this._floor.filter(e=>s.some(t=>t.x===e.x&&t.z===e.z)),buttons:this._buttons.filter(e=>s.some(t=>t.x===e.x&&t.z===e.z)),gates:this._gates.filter(e=>s.some(t=>t.x===e.x&&t.z===e.z)),blocks:this._blocks.filter(e=>s.some(t=>t.x===e.x&&t.z===e.z)),goals:this._goals.filter(e=>s.some(t=>t.x===e.x&&t.z===e.z)),starts:this._starts.filter(e=>s.some(t=>t.x===e.x&&t.z===e.z)),scenes:this._scenes.filter(e=>s.some(t=>t.x===e.x&&t.z===e.z))})}getHeight(e,t){return this._height[e][t]}static getTileData(e,t,s){return 255===e?{type:"floor",y:t}:230===e?{type:"scene_crash",y:t}:200===e?{type:"start",y:t}:150===e?{type:"button",y:t,connection:s}:110===e?{type:"gate_90",y:t,connection:s,angle:90}:100===e?{type:"gate",y:t,connection:s,angle:0}:80===e?{type:"auto_gate_90",y:t,connection:s,angle:90}:70===e?{type:"auto_gate",y:t,connection:s,angle:0}:50===e?{type:"block",y:t}:0===e?{type:"goal",y:t}:void 0}}class k extends i.a{constructor(e){super(e),this.resources=["assets/pink-cube/crash.glb","assets/pink-cube/map.png","assets/pink-cube/goal.gltf"],this.levelIndex=0,this.onKeyDown=this.onKeyDown.bind(this)}show(e){this.app.renderer.backgroundColor=16758008,this.lightingEnvironment=new PIXI3D.LightingEnvironment(this.app.renderer,new PIXI3D.ImageBasedLighting(PIXI3D.Cubemap.fromColors(PIXI3D.Color.fromBytes(140,140,140),PIXI3D.Color.fromBytes(140,140,140),PIXI3D.Color.fromBytes(230,230,230),PIXI3D.Color.fromBytes(120,120,120),PIXI3D.Color.fromBytes(160,160,160),PIXI3D.Color.fromBytes(160,160,160)),PIXI3D.Cubemap.fromColors(PIXI3D.Color.fromBytes(255,255,255)))),this.sounds=new Howl({autoplay:!1,src:["assets/pink-cube/sounds.ogg","assets/pink-cube/sounds.m4a","assets/pink-cube/sounds.mp3","assets/pink-cube/sounds.ac3"],sprite:{sad:[0,9366.666666666668],tap:[11e3,291.65532879818556],win:[13e3,1025.1700680272115]}});const t=new D(this.app.renderer,e["assets/pink-cube/map.png"].texture);this.ui=new P,this.ui.onUp=()=>this.level.movePlayerFoward(),this.ui.onDown=()=>this.level.movePlayerBackward(),this.ui.onRight=()=>this.level.movePlayerRight(),this.ui.onLeft=()=>this.level.movePlayerLeft(),this.ui.onReset=()=>this.level.loadSection(t,this.levelIndex),this.ui.show(),document.addEventListener("keydown",this.onKeyDown),this.level=this.app.stage.addChild(new z(e,this.app.view,this.sounds,this.lightingEnvironment)),this.level.loadSection(t,this.levelIndex),this.level.onGoal=()=>{gsap.to(this.flash,{duration:.3,alpha:1,ease:"power3.out",onComplete:()=>{this.levelIndex=(this.levelIndex+1)%t.levels,this.level.loadSection(t,this.levelIndex),gsap.to(this.flash,{duration:.3,alpha:0,ease:"power3.out",delay:.05})}})},this.level.onReset=()=>{this.ui.show(),gsap.to(this.flash,{duration:.3,alpha:1,ease:"power3.out",onComplete:()=>{this.cinema.value=0,this.level.loadSection(t,this.levelIndex),gsap.to(this.flash,{duration:.3,alpha:0,ease:"power3.out",delay:.05})}})},this.level.onScene=()=>{setTimeout(()=>{this.ui.hide()},1e3),gsap.to(this.cinema,{duration:2,value:1,ease:"sine.inOut"})},this.cinema={value:0},this.cinema1=this.app.stage.addChild(new PIXI.Graphics),this.cinema1.beginFill(0),this.cinema1.drawRect(0,0,32,32),this.cinema1.endFill(),this.cinema2=this.app.stage.addChild(new PIXI.Graphics),this.cinema2.beginFill(0),this.cinema2.drawRect(0,0,32,32),this.cinema2.endFill(),this.flash=this.app.stage.addChild(new PIXI.Sprite(PIXI.Texture.WHITE)),this.flash.alpha=0,this.app.ticker.add(()=>{this.flash.width=this.app.renderer.width,this.flash.height=this.app.renderer.height,this.cinema2.width=this.app.renderer.width,this.cinema2.height=.15*this.app.renderer.height*this.cinema.value,this.cinema2.y=this.app.renderer.height-.15*this.app.renderer.height*this.cinema.value,this.cinema1.width=this.app.renderer.width,this.cinema1.height=.15*this.app.renderer.height*this.cinema.value})}onKeyDown(e){switch(e.key){case"a":case"ArrowLeft":this.level.movePlayerLeft();break;case"w":case"ArrowUp":this.level.movePlayerFoward();break;case"s":case"ArrowDown":this.level.movePlayerBackward();break;case"d":case"ArrowRight":this.level.movePlayerRight()}}hide(){document.removeEventListener("keydown",this.onKeyDown),this.ui.remove(),this.app.stage.removeChildren()}}}]);